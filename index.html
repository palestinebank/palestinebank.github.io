<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>رفع ملفات JSON إلى GitHub</title>
</head>
<body>
  <h2>رفع ملفات JSON إلى GitHub</h2>

  <input type="file" id="file1" accept=".json"><br><br>
  <input type="file" id="file2" accept=".json"><br><br>
  <button onclick="uploadFiles()">رفع الملفات</button>

  <p id="status"></p>

  <script>
    async function uploadFiles() {
      const fileInputs = [document.getElementById('file1'), document.getElementById('file2')];
      const status = document.getElementById('status');

      // إعدادات GitHub
      const username = 'اسم_المستخدم_هنا';
      const repo = 'اسم_المستودع_هنا';
      const branch = 'main'; // أو master
      const token = 'ghp_ضع_هنا_التوكن_الخاص_بك';

      for (const input of fileInputs) {
        const file = input.files[0];
        if (!file) continue;

        const content = await file.text();
        const base64Content = btoa(unescape(encodeURIComponent(content)));
        const path = file.name;

        const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;

        // تحقق إن كان الملف موجودًا بالفعل للحصول على sha
        let sha = null;
        try {
          const res = await fetch(url, {
            headers: { 'Authorization': `token ${token}` }
          });
          if (res.ok) {
            const json = await res.json();
            sha = json.sha;
          }
        } catch (e) {}

        const body = {
          message: `رفع الملف ${file.name}`,
          content: base64Content,
          branch: branch,
          ...(sha && { sha }) // إذا كان الملف موجود، نحتاج sha لتحديثه
        };

        const response = await fetch(url, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        });

        if (response.ok) {
          status.innerText += `✅ تم رفع ${file.name} بنجاح\n`;
        } else {
          const err = await response.json();
          status.innerText += `❌ فشل رفع ${file.name}: ${err.message}\n`;
        }
      }
    }
  </script>
</body>
</html>
