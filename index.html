<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>رفع ملفات JSON إلى GitHub</title>
</head>
<body>
  <h2>رفع ملفات JSON إلى GitHub</h2>

  <label>اختر ملفات JSON:</label><br>
  <input type="file" id="jsonFiles" multiple accept=".json"><br><br>

  <label>GitHub Username:</label><br>
  <input type="text" id="username"><br><br>

  <label>Repository Name:</label><br>
  <input type="text" id="repo"><br><br>

  <label>Branch Name (مثل: main):</label><br>
  <input type="text" id="branch" value="main"><br><br>

  <label>GitHub Token:</label><br>
  <input type="password" id="token"><br><br>

  <button onclick="uploadJSONFiles()">رفع الملفات</button>

  <pre id="status" style="white-space: pre-wrap; margin-top: 20px;"></pre>

  <script>
    async function uploadJSONFiles() {
      const files = document.getElementById('jsonFiles').files;
      const username = document.getElementById('username').value;
      const repo = document.getElementById('repo').value;
      const branch = document.getElementById('branch').value;
      const token = document.getElementById('token').value;
      const status = document.getElementById('status');
      status.innerText = '';

      if (!username || !repo || !branch || !token) {
        status.innerText = "⚠️ يرجى ملء جميع الحقول.";
        return;
      }

      for (const file of files) {
        const content = await file.text();
        const base64Content = btoa(unescape(encodeURIComponent(content)));
        const path = file.name;

        const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;

        let sha = null;
        try {
          const check = await fetch(url, {
            headers: { 'Authorization': `token ${token}` }
          });
          if (check.ok) {
            const data = await check.json();
            sha = data.sha;
          }
        } catch (err) {}

        const body = {
          message: `رفع الملف ${file.name}`,
          content: base64Content,
          branch: branch,
          ...(sha && { sha })
        };

        const response = await fetch(url, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        });

        if (response.ok) {
          status.innerText += `✅ تم رفع الملف: ${file.name}\n`;
        } else {
          const err = await response.json();
          status.innerText += `❌ خطأ في رفع ${file.name}: ${err.message}\n`;
        }
      }
    }
  </script>
</body>
</html>
