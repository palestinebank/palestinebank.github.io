<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>رفع ملف إلى GitHub</title>
  <style>
    body { font-family: Arial; direction: rtl; padding: 20px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; }
    input, button, select { width: 100%; padding: 8px; margin-top: 5px; }
    #status { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>

  <h2>🔼 رفع ملف إلى GitHub</h2>

  <label>GitHub Username:
    <input type="text" id="username" placeholder="مثال: salyayed" />
  </label>

  <label>Repository Name:
    <input type="text" id="repo" placeholder="مثال: pal-map" />
  </label>

  <label>Branch Name:
    <input type="text" id="branch" value="main" />
  </label>

  <label>GitHub Token:
    <input type="password" id="token" placeholder="توكن بصلاحية repo" />
  </label>

  <label>اختيار الملف لرفعه:
    <input type="file" id="fileInput" />
  </label>

  <button onclick="uploadToGitHub()">🚀 رفع الملف</button>

  <div id="status"></div>

  <script>
    async function uploadToGitHub() {
      const username = document.getElementById('username').value.trim();
      const repo = document.getElementById('repo').value.trim();
      const branch = document.getElementById('branch').value.trim();
      const token = document.getElementById('token').value.trim();
      const fileInput = document.getElementById('fileInput');
      const status = document.getElementById('status');

      if (!username || !repo || !branch || !token || !fileInput.files.length) {
        alert('يرجى تعبئة جميع الحقول واختيار الملف');
        return;
      }

      const file = fileInput.files[0];
      const fileName = file.name;
      const reader = new FileReader();

      reader.onload = async function () {
        const content = reader.result;
        const base64Content = btoa(content);

        // التحقق إن كان الملف موجودًا مسبقًا للحصول على SHA
        let sha = null;
        try {
          const getRes = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${fileName}`, {
            headers: { Authorization: `token ${token}` }
          });
          if (getRes.ok) {
            const getData = await getRes.json();
            sha = getData.sha;
          }
        } catch (e) {}

        const payload = {
          message: `Upload ${fileName} via browser`,
          content: base64Content,
          branch: branch
        };

        if (sha) payload.sha = sha;

        const url = `https://api.github.com/repos/${username}/${repo}/contents/${fileName}`;

        try {
          const res = await fetch(url, {
            method: 'PUT',
            headers: {
              Authorization: `token ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
          });

          if (res.ok) {
            status.innerText = `✅ تم رفع الملف "${fileName}" بنجاح.`;
            status.style.color = 'green';
          } else {
            const err = await res.json();
            status.innerText = `❌ فشل الرفع: ${err.message}`;
            status.style.color = 'red';
          }
        } catch (err) {
          status.innerText = '❌ حدث خطأ أثناء الاتصال بـ GitHub.';
          status.style.color = 'red';
        }
      };

      reader.readAsBinaryString(file);
    }
  </script>
</body>
</html>
